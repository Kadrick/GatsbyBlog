"use strict";(self.webpackChunkfake_programmer=self.webpackChunkfake_programmer||[]).push([[905],{8663:function(e,t,n){n.r(t),n.d(t,{default:function(){return E}});var a=n(1151),l=n(7294);function r(e){const t=Object.assign({h2:"h2",p:"p",hr:"hr",a:"a",span:"span",ol:"ol",li:"li",ul:"ul",strong:"strong"},(0,a.ah)(),e.components),{Delete:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Delete",!0),l.createElement(l.Fragment,null,l.createElement(t.h2,null,"문제 상황"),"\n",l.createElement(t.p,null,"AWS Lambda 함수를 작성하던 중, AWS RDS와의 연결과 API 호출이 필요한 상황이었다. RDS 연결을 위해서 Lambda에 이미 VPC를 설정해놓은 상태였는데, 이후 API 호출이 실패하기 시작했다."),"\n",l.createElement(t.hr),"\n",l.createElement(t.h2,null,"문제 해결"),"\n",l.createElement(t.p,null,"약간 삽질하다가 ",l.createElement(t.a,{href:"https://repost.aws/ko/knowledge-center/internet-access-lambda-function"},"AWS Post"),"에서 해결책을 찾을 수 있었다.\nLambda는 내부망에서 실행되기 때문에, Lambda에서 외부 API를 호출할 때는 NAT Gateway를 통해서 인터넷 인터넷 게이트웨이에 연결이 필요하다는 것이었다. ",l.createElement(n,null,"(근데, Mediaconvert나 System Manager는 같은 AWS 서비스 인데...)")),"\n",l.createElement(t.p,null,"아래 그림의 New Version부분과 설정 순서를 확인해보자."),"\n",l.createElement("br"),"\n",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/static/a92e053aeab4e51e6dfb50e0b513c4b9/21b4d/diagram.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 98.15950920245399%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD0klEQVR42nVUW08bRxQejC/YLhjXLcbYjo0v2FlfYdllbQyjGDuksRtCpVGjNhFVqy5KCKqMH5zWSKOmFxpBSKhA0aoPUVVFrSw1UvPQPlQqjSr1oe07P2c7Z+11bEhG+jS7M2e+OXPOdw6ilBp0IKQO6FA7gHVZUUyyrJh6bV8FhKhqQIQMIjZm7kek2f3Y22zRINUkq0QkKy/zplJDdlza3BzBFBvhH6B9K7wJ9TpCWowHFigyAOH8IVeQHiZXOUTM8auCCxP8Gu3ssTFwCgjJQNiz3/aQ6gsIbtZmxWPLHyUOpz6dTFuJzxtsjgfYQTM6NTClRqRq5IaXEnKUMzMDA4H5QSD7UzO4fnIv9MMYtYTQAbKsi79yNwt/l8Crldij4ArXygbWAkOh1GIqmMrHzhBiiowwa8/cQc5vatFrz7aTX3moK46OkfGDuSfRG4UnJbBZzuwEy3Ofz0UuRSxcBmfjMxf4lxMCGUNqx+F03XMNQ/ADDxyj+Lh9mbbPnglEhfdSzk4MB7pP1tOtquoAxDCyGbHATFjmKSOTq7wtXS7b0+W0nWffvCx3s0xaZLBtRw0wA1CfhlRVy56uP+0SvmpbWF71FIvX3JIkWSmTVK9Gz+iQ9shG/Da6ID6MEfZ4Y1Wu2tLXy3bwokqprVy/bgfPfEybALyGhyCunSy3o9GNYYcwd5QQ8geJi0xgJuEWNw461A4AmE0uVx6TihXv/HzpXL5UmsitlscKlYqT44i5n/CUDtO7bnv+kDtK3Q3z8Y3JqUjTH45+5vPqwadMd/BkkBnG2NgV+hlCBZlAMpCY9G5wLvvxhXx++ZMr4W1/YuILp18QllxxYdh1o/A9vi39K7Y9p6+uFMQy9754MEK4lpkJeSQup2ZEcrly/u5w1EutPt2Td/BefA0/jusSe3H+BaFmyBHOvL7wx8pHpT/Pjx/scn56ZcKzxb/hoCujAYpHEes47UaAUDH5nfut9I9TMgtTKLsY9WWK3rZK+kqPmCuFO6HZd/f8ib2/HvlqT8XKzTr/4XZjeqj5j9/R+C2IaEtLwFJqP1Sa3p8FbUb5ohieXsx1dSiKok8QhIQ4n80kk5NuaGexxuMg2lBdz5sLX558nfkZbZxMvNl8GtYJ+WrVJlwWxsEWEoMxNArmIfzEYrFhRjrCXeRe53neBhvOxrNzqP58cu3W1tLWbfmqpfZLxHHn95BOqI0WGjwTQ9qXlE4tM0Nf7b7VXd+1I+U/EyLqoLtet3uoYkPHTCZApJGxrtRDSHtrmXRc76vTVrueFajtzj/s9eJU+zf8D4umZiPJOUHpAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="VPC Setting"\n        title=""\n        src="/static/a92e053aeab4e51e6dfb50e0b513c4b9/a6d36/diagram.png"\n        srcset="/static/a92e053aeab4e51e6dfb50e0b513c4b9/222b7/diagram.png 163w,\n/static/a92e053aeab4e51e6dfb50e0b513c4b9/ff46a/diagram.png 325w,\n/static/a92e053aeab4e51e6dfb50e0b513c4b9/a6d36/diagram.png 650w,\n/static/a92e053aeab4e51e6dfb50e0b513c4b9/e548f/diagram.png 975w,\n/static/a92e053aeab4e51e6dfb50e0b513c4b9/21b4d/diagram.png 1280w"\n        sizes="(max-width: 650px) 100vw, 650px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}}),"\n",l.createElement("br"),"\n",l.createElement(t.ol,null,"\n",l.createElement(t.li,null,"NAT Gateway에 설정할 EIP(Elastic IP, 고정형 공인 IP)를 하나 발급받는다. (AWS에서는 탄력적인 IP 주소라고 부른다.)"),"\n",l.createElement(t.li,null,"원래 인터넷과 연결되어 있던 서브넷에 NAT Gateway를 생성한다.","\n",l.createElement(t.ul,null,"\n",l.createElement(t.li,null,"1번에서 생성한 EIP를 할당해준다."),"\n"),"\n"),"\n",l.createElement(t.li,null,"Private 서브넷을 생성하고 route table을 이용해서 Private 서브넷의 아웃바운드를 NAT Gateway로 설정한다.","\n",l.createElement(t.ul,null,"\n",l.createElement(t.li,null,"여기서 필터링을 적용할 수 있는데, 일단 모든 아웃바운드를 NAT Gateway로 보냈음"),"\n"),"\n"),"\n",l.createElement(t.li,null,"Lambda의 VPC 설정에서 3번에서 생성한 Private 서브넷을 설정해준다.","\n",l.createElement(t.ul,null,"\n",l.createElement(t.li,null,"Lambda에서 VPC이 안될 경우, 실행 역할에 ",l.createElement(t.strong,null,"AWSLambdaVPCAccessExecutionRole")," 정책이 있는지 확인하자."),"\n"),"\n"),"\n"),"\n",l.createElement(t.hr),"\n",l.createElement(t.h2,null,"NAT Instance 이야기"),"\n",l.createElement(t.p,null,"NAT Gateway가 하는 일은 근본적으로 내부에서 할당된 Private IP를 Public IP로 변환해주는 일이다.\n즉, ",l.createElement(t.strong,null,"NAT Gateway를 쓰지 않더라도")," Public IP(공인 IP)를 가지고 있는 Instance에서 이 작업을 수행할 수 있다.\n그리고, 이런 Instance를 쉽게 구축할 수 있도록 커뮤니티에 NAT Instance 이미지가 많이 있다."),"\n",l.createElement("br"),"\n",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/static/263ed858f35f0b1a8ee7478a67ca4fd7/eacc8/nat-ami.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 109.81595092024541%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAABYlAAAWJQFJUiTwAAAERUlEQVR42n1U32/bVBSOVClSK/UF9oL4F6LSrgnpQlq2qQO0DiboCy+wSpB/BmnkhQcE0qQJ8VJNmoqGtE0tLVQaBFVNQ6sx0JomTmI78W8n8bV9bR/Ouem0ZjCu9OleXx9//s53zr2pXCaTXSjkvpo9n/syk5kpZzKZ8szsfDmXv1AuForlYnGpXFy6iPPFcqFA60vl+Vy+nJmZK8/OzZdnMTabXbiZzeW/npnJzqXyb6+Urq9+AsvXVuOFpfcge2EZ5hHZt65AtrAM+cV3AWPgzaVrArml0bpw+TosXvkIissfwuI7q/zS1Y/hfP7yWmp//+Azx+mDx1hguwNeb0j8uN4Qc7uj8BahLYt1B9FsdXhHUblpWlx/DhaEHHZ3dz9N7e3tlZIkARwx5xzcfh/iOIaXDYrlPBKguBCJmO9zeodca6lqtVbyg5BexmEYQn8wAMMwwXFcQW7j3NN03B9Ct6fBAGcijaJYII4TJA0FYaVSWUvVarUSY74gJIVDz4N+fwAB/oQxD4ltcGwbLMvCHxm4H0CCyghxFCFp9CJhtUT503siJCWq2sMPfXCHDCRVg55pQ9ewwUCvhz5m4QXQZwG4HsbgGveeE5KHHheeiZR93xekccTBCRI4qMvwpClDXTXgaUeDp7IGku5CU3Og0bOgiTCHZwir1WqJhSibc6GQPFLUrkglQn+oXobtwkmrAx1Uq2gGqLop1DIsjI/vfR6Ne0gVQ4NjInFcF3T0ioYfeHDY+h3aSgv+evI3NE4aIMvyCIoCgc8gam1B5OnjCj2PiaIIQqxqu90RhPTsBUOstgtqtweGaYJpYYGwSI7bR3sCajaM4+MKY8wrPu3DAbaNiR/S4FEIdfkx9PQunKA6qdVGdYqAbTtEBFz6CRUa4wqHqBDVCEJSa6MC0cBI2LYaoFsadGQVNF0fqTQtXBswGHrY6dG4QlEU7EMifOahgR8MhlhpUh5woeak0URSWfSiro/AGHn4gsKjo6OS8Ou0sanKFOgxoVqkToQtrDIVi/yjZwu9pDjscIr7N+Gzs0ynpNVun3rI4UR5DEpXhuPjulDnYgZE2MdjSaeFy48gYtbLCSlVRVWFOuxMkKw6aJaO6kyRJtlhIaGG5JQNsmFs+P+EZD4VhW4Tnw1A0zSo/XEIkiRhWzniXFNRfOzDxK5DFAzG20awYRviNZRgyomsqEkYhAkLWFJr/pbIvU4iSe0ErUiwdZIWoiFJCVqQRMafSciccHR9VW6MKSRFpOwscBtbyRsVBJVRS5FKOvNiBD0892fuw+++X/+8sncAO7u/xg+3fobN7V3Y+eURbCMebG3DzdtfwPrGXVi/8wPcuXsPNu7dhx/vb8KDzR3YotiNb2Bn6yGv7B/Ct7du30hNTr7y+uT0q+9PTEyspFKp/8AUYuJ0Tgukp88JTKSnV9Ln3lhJT527mp6c/mBqauq1fwB+D8Bg58b4YwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="ami-list"\n        title=""\n        src="/static/263ed858f35f0b1a8ee7478a67ca4fd7/a6d36/nat-ami.png"\n        srcset="/static/263ed858f35f0b1a8ee7478a67ca4fd7/222b7/nat-ami.png 163w,\n/static/263ed858f35f0b1a8ee7478a67ca4fd7/ff46a/nat-ami.png 325w,\n/static/263ed858f35f0b1a8ee7478a67ca4fd7/a6d36/nat-ami.png 650w,\n/static/263ed858f35f0b1a8ee7478a67ca4fd7/e548f/nat-ami.png 975w,\n/static/263ed858f35f0b1a8ee7478a67ca4fd7/3c492/nat-ami.png 1300w,\n/static/263ed858f35f0b1a8ee7478a67ca4fd7/eacc8/nat-ami.png 3232w"\n        sizes="(max-width: 650px) 100vw, 650px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}}),"\n",l.createElement("br"),"\n",l.createElement(t.p,null,"그런데, 왜 Instance 까지 만들어서 NAT Gateway를 대체하고자 할까?"),"\n",l.createElement(t.p,null,"요금표를 보면 알 수 있다."),"\n",l.createElement("br"),"\n",l.createElement(t.ul,null,"\n",l.createElement(t.li,null,"데이터 전송 요금은 모두 EC2 표준 데이터 전송 요금 적용"),"\n",l.createElement(t.li,null,l.createElement(t.a,{href:"https://aws.amazon.com/ko/vpc/pricing/"},"AWS VPC 요금"),"\n",l.createElement(t.ul,null,"\n",l.createElement(t.li,null,"시간당 0.059 USD + 데이터 처리 요금"),"\n"),"\n"),"\n",l.createElement(t.li,null,l.createElement(t.a,{href:"https://aws.amazon.com/ko/ec2/pricing/on-demand/"},"EC2 On-demand 요금"),"\n",l.createElement(t.ul,null,"\n",l.createElement(t.li,null,"t3.micro: 시간당 0.0104 USD"),"\n",l.createElement(t.li,null,"t3.medium: 시간당 0.0416 USD"),"\n"),"\n"),"\n"),"\n",l.createElement("br"),"\n",l.createElement(t.p,null,"확인할 수 있듯이 가격차이가 상당하기 때문에 상황에 맞게 Gateway와 Instance를 선택해야한다.\n고려할 수 있는 상황이라면, CloudWatch를 통한 모니터링 및 유지 관리 같은 것이 있지 않을까?"),"\n",l.createElement(t.hr),"\n",l.createElement(t.h2,null,"요약"),"\n",l.createElement(t.ol,null,"\n",l.createElement(t.li,null,"AWS Lambda에서 외부 API 호출이 안되었음 -> AWS Lambda의 VPC 설정 문제임을 파악"),"\n",l.createElement(t.li,null,"NAT Gateway에 고정 IP 할당하고 VPC를 올바르게 설정해서 해결"),"\n",l.createElement(t.li,null,"NAT Gateway 말고, NAT 역할을 하는 인스턴스를 띄워보는건 어떨까? 생각해보기"),"\n",l.createElement(t.li,null,l.createElement(t.strong,null,"같은 AWS 서비스 간의 통신이라도 인터넷 연결이 필요하다.")),"\n"),"\n",l.createElement(t.hr),"\n",l.createElement(t.h2,null,"Ref."),"\n",l.createElement(t.ul,null,"\n",l.createElement(t.li,null,l.createElement(t.a,{href:"https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/nat-gateway-scenarios.html"},"AWS VPC Docs")),"\n",l.createElement(t.li,null,l.createElement(t.a,{href:"https://repost.aws/ko/knowledge-center/internet-access-lambda-function"},"AWS Blog Post")),"\n",l.createElement(t.li,null,l.createElement(t.a,{href:"https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/vpc-nat-comparison.html"},"NAT Gateway vs NAT Instance")),"\n"))}var c=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,a.ah)(),e.components);return t?l.createElement(t,e,l.createElement(r,e)):r(e)};var i=n(6642),m=n(1058),s=n(3187),o=n(2757),u=n(2675),p=n(7747),d=n(7710),g=n(8371),b=n(3200);const A=e=>{var t,n,r,c;let{data:A,children:E}=e;return A.mdx.frontmatter?l.createElement(i.Z,null,l.createElement(b.Z,{title:A.mdx.frontmatter.title||"",url:(A.site.siteMetadata.siteUrl||"")+"/post/"+(A.mdx.frontmatter.slug||""),description:A.mdx.frontmatter.description||""}),l.createElement(p.xu,{pt:"50px",width:"80vw"},l.createElement(o.X,null,A.mdx.frontmatter.title),A.mdx.frontmatter.description&&l.createElement(u.x,{mt:"5px",color:"gray"},A.mdx.frontmatter.description),A.mdx.frontmatter.date&&l.createElement(o.X,{mt:"40px",size:"18px",color:"gray"},["January","February","March","April","May","June","July","August","September","October","November","December"][new Date(null===(t=A.mdx.frontmatter.date)||void 0===t?void 0:t.toString()).getMonth()]," ",new Date(null===(n=A.mdx.frontmatter.date)||void 0===n?void 0:n.toString()).getDate(),", ",new Date(null===(r=A.mdx.frontmatter.date)||void 0===r?void 0:r.toString()).getFullYear()),A.mdx.frontmatter.tags&&l.createElement(d.E,{mt:"20px"},null===(c=A.mdx.frontmatter.tags)||void 0===c?void 0:c.map(((e,t)=>l.createElement(d.U,{key:t},l.createElement(g.Vp,null,e)))))),l.createElement(p.xu,{mt:"50px",width:"80vw"},l.createElement(a.Zo,{components:m.Z},E))):l.createElement(i.Z,null,l.createElement(s.g,{h:"100%",justifyContent:"center"},l.createElement(o.X,{pb:"10px"},"Something Wrong"),l.createElement(u.x,null,"죄송합니다, 페이지에 로딩에 문제가 있습니다.",l.createElement("br",null)," 관리자에게 문의 해주세요.")))};function E(e){return l.createElement(A,e,l.createElement(c,e))}}}]);
//# sourceMappingURL=component---src-layout-post-tsx-content-file-path-src-posts-aws-lambda-lambda-vpc-setting-index-mdx-16366a73cfc490339dd1.js.map